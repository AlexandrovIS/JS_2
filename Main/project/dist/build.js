(()=>{"use strict";Vue.component("search",{template:'<input @input="check" v-model="search" placeholder="ПОИСК">',data:()=>({search:"",arrFiltered:[]}),methods:{check(){""===this.search&&(this.arrFiltered=this.goods_arr);const t=new RegExp(this.search,"i");this.arrFiltered=this.goods_arr.filter((e=>t.test(e.title))),this.$emit("filtred",this.arrFiltered)}},props:{goods_arr:Array}}),Vue.component("cart",{template:'<div class="container">\n  <div class="header_top">\n   <search v-bind:goods_arr="arr" @filtred="filterHandler"></search>\n  <button class="cart-button" @click="openCartHandler" type="button">\n  BIN <span v-if="cart_arr.length>0">{{cart_arr.length}}</span></button> \n</div>\n  <div v-if="isVisibleCart" class="header_bottom">\n  <slot> </slot>\n  <h3>SUM <span v-if="cartSum()>0">{{cartSum()}}</span></h3>\n  </div>\n  </div>',data:()=>({isVisibleCart:!0}),props:{cart_arr:Array,arr:Array},methods:{openCartHandler(){this.isVisibleCart=!this.isVisibleCart},cartSum(){return this.cart_arr.reduce(((t,e)=>t+e.price),0)},filterHandler(t){this.$emit("filter",t)}}}),Vue.component("goods-item",{template:'<div :data-id="id" class="goods-item" >\n  <h3>{{title}}</h3>\n  <img src="" alt="img">\n  <p>{{price}}</p>\n  <button v-on:click="add" class="item-button">add</button>\n  </div>',props:["title","price","id"],methods:{add(t){this.$emit("buttoadd",this.id)}}}),Vue.component("goods-item-cart",{template:'<div :data-id="id" class="goods-item" >\n  <h3>{{title}}</h3>\n  <p>{{price}}</p>\n  <button v-on:click="add"> del </button>\n  </div>',props:["title","price","id"],methods:{add(t){this.$emit("buttoadd",this.id)}}}),new Vue({el:"#app",data:{cart:[],goods:[],filtredGoods:[],isLoaded:!1},methods:{addToCartHandler(t){const e=this.goods.find((e=>e.id==t));fetch("/cart",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),this.cart.push(e)},removeFromCartHandler(t){const e=this.cart.findIndex((e=>e.id==t));this.cart.splice(e,1),fetch("/cart",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.cart)})},searchHandler(t){this.filtredGoods=t}},mounted(){fetch("/data").then((t=>t.json())).then((t=>{this.goods=t,this.filtredGoods=t,this.isLoaded=!0})).catch((t=>{document.querySelector(".goods-list").innerHTML=t})),fetch("/cart").then((t=>t.json())).then((t=>{this.cart=t})).catch((t=>{console.log(t)}))}})})();